metadata:
  name: consumeumidity
  labels:
    nuclio.io/project-name: e9ceee15-7342-462a-870d-5f4c2227995b
spec:
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-consumeumidity:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
    ReceiveUmidity_Trigger:
      class: ""
      kind: mqtt
      url: "guest:guest@192.168.1.20:1883"
      attributes:
        subscriptions:
          - qos: 0
            topic: iot/sensors/umidity
  version: 1
  build:
    functionSourceCode: dmFyIGFtcXAgPSByZXF1aXJlKCJhbXFwbGliIik7DQp2YXIgRlVOQ1RJT05fTkFNRSA9ICJBU0QiDQoNCmZ1bmN0aW9uIHNlbmRfYWxlcnQobXNnKSB7DQogIHZhciBxID0gImlvdC9hbGVydHMiOw0KICBhbXFwDQogICAgLmNvbm5lY3QoImFtcXA6Ly9ndWVzdDpndWVzdEAxOTIuMTY4LjEuMjA6NTY3MiIpDQogICAgLnRoZW4oZnVuY3Rpb24gKGNvbm4pIHsNCiAgICAgIHJldHVybiBjb25uDQogICAgICAgIC5jcmVhdGVDaGFubmVsKCkNCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGNoKSB7DQogICAgICAgICAgdmFyIG9rID0gY2guYXNzZXJ0UXVldWUocSwgeyBkdXJhYmxlOiBmYWxzZSB9KTsNCiAgICAgICAgICByZXR1cm4gb2sudGhlbihmdW5jdGlvbiAoX3Fvaykgew0KICAgICAgICAgICAgY2guc2VuZFRvUXVldWUocSwgQnVmZmVyLmZyb20obXNnKSk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiIFt4XSBTZW50ICclcyciLCBtc2cpOw0KICAgICAgICAgICAgcmV0dXJuIGNoLmNsb3NlKCk7DQogICAgICAgICAgfSk7DQogICAgICAgIH0pDQogICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICBjb25uLmNsb3NlKCk7DQogICAgICAgIH0pOw0KICAgIH0pDQogICAgLmNhdGNoKGNvbnNvbGUud2Fybik7DQp9DQoNCmZ1bmN0aW9uIHNlbmRfbG9ncyhtc2cpIHsNCiAgdmFyIHEgPSAiaW90L2xvZ3MiOw0KICBhbXFwDQogICAgLmNvbm5lY3QoImFtcXA6Ly9ndWVzdDpndWVzdEAxOTIuMTY4LjEuMjA6NTY3MiIpDQogICAgLnRoZW4oZnVuY3Rpb24gKGNvbm4pIHsNCiAgICAgIHJldHVybiBjb25uDQogICAgICAgIC5jcmVhdGVDaGFubmVsKCkNCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGNoKSB7DQogICAgICAgICAgdmFyIG9rID0gY2guYXNzZXJ0UXVldWUocSwgeyBkdXJhYmxlOiBmYWxzZSB9KTsNCiAgICAgICAgICByZXR1cm4gb2sudGhlbihmdW5jdGlvbiAoX3Fvaykgew0KICAgICAgICAgICAgY2guc2VuZFRvUXVldWUocSwgQnVmZmVyLmZyb20obXNnKSk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiIFt4XSBTZW50ICclcyciLCBtc2cpOw0KICAgICAgICAgICAgcmV0dXJuIGNoLmNsb3NlKCk7DQogICAgICAgICAgfSk7DQogICAgICAgIH0pDQogICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICBjb25uLmNsb3NlKCk7DQogICAgICAgIH0pOw0KICAgIH0pDQogICAgLmNhdGNoKGNvbnNvbGUud2Fybik7DQp9DQoNCmZ1bmN0aW9uIGJpbjJzdHJpbmcoYXJyYXkpIHsNCiAgdmFyIHJlc3VsdCA9ICIiOw0KICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKSB7DQogICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYXJyYXlbaV0pOw0KICB9DQogIHJldHVybiByZXN1bHQ7DQp9DQoNCmV4cG9ydHMuaGFuZGxlciA9IGZ1bmN0aW9uIChjb250ZXh0LCBldmVudCkgew0KICB2YXIgX2V2ZW50ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShldmVudCkpOw0KICB2YXIgX2RhdGEgPSBiaW4yc3RyaW5nKF9ldmVudC5ib2R5LmRhdGEpOw0KICB2YXIgdW1pZGl0eSA9IHBhcnNlSW50KF9kYXRhKTsNCg0KICBjb250ZXh0LmNhbGxiYWNrKCJmZWVkYmFjayAiICsgX2RhdGEpOw0KDQogIGNvbnNvbGUubG9nKCJUUklHR0VSICIgKyBfZGF0YSk7DQoNCiAgdW1pZGl0eSA8PSAxMCA/IHNlbmRfYWxlcnQoIiIgKyB1bWlkaXR5KSA6IHNlbmRfbG9ncygiIiArIHVtaWRpdHkpOw0KfTsNCg==
    commands:
      - 'npm install amqplib'
    runtimeAttributes:
      repositories: []
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
