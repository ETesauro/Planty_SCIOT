metadata:
  name: consumehumidity
  labels:
    nuclio.io/project-name: 40bdb3af-1647-42c3-b1f0-4830b5803117
spec:
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-consumehumidity:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
    ReceiveHumidity_Trigger:
      kind: mqtt
      attributes:
        subscriptions:
          - topic: iot/sensors/humidity
            qos: 0
      workerAllocatorName: ""
      url: "guest:guest@192.168.178.103:1883"
  version: 1
  build:
    image: ""
    noCache: false
    offline: false
    dependencies: []
    runtimeAttributes:
      repositories: []
    functionSourceCode: dmFyIGFtcXAgPSByZXF1aXJlKCJhbXFwbGliIik7DQoNCmZ1bmN0aW9uIHNlbmRfYWxlcnQobXNnKSB7DQogIHZhciBxID0gImlvdC9hbGVydHMiOw0KICBhbXFwDQogICAgLmNvbm5lY3QoImFtcXA6Ly9ndWVzdDpndWVzdEAxOTIuMTY4LjE3OC4xMDM6NTY3MiIpDQogICAgLnRoZW4oZnVuY3Rpb24gKGNvbm4pIHsNCiAgICAgIHJldHVybiBjb25uDQogICAgICAgIC5jcmVhdGVDaGFubmVsKCkNCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGNoKSB7DQogICAgICAgICAgdmFyIG9rID0gY2guYXNzZXJ0UXVldWUocSwgeyBkdXJhYmxlOiBmYWxzZSB9KTsNCiAgICAgICAgICByZXR1cm4gb2sudGhlbihmdW5jdGlvbiAoX3Fvaykgew0KICAgICAgICAgICAgY2guc2VuZFRvUXVldWUocSwgQnVmZmVyLmZyb20obXNnKSk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiIFt4XSBTZW50ICclcyciLCBtc2cpOw0KICAgICAgICAgICAgcmV0dXJuIGNoLmNsb3NlKCk7DQogICAgICAgICAgfSk7DQogICAgICAgIH0pDQogICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICBjb25uLmNsb3NlKCk7DQogICAgICAgIH0pOw0KICAgIH0pDQogICAgLmNhdGNoKGNvbnNvbGUud2Fybik7DQp9DQoNCmZ1bmN0aW9uIHNlbmRfbG9ncyhtc2cpIHsNCiAgdmFyIHEgPSAiaW90L2xvZ3MiOw0KICBhbXFwDQogICAgLmNvbm5lY3QoImFtcXA6Ly9ndWVzdDpndWVzdEAxOTIuMTY4LjE3OC4xMDM6NTY3MiIpDQogICAgLnRoZW4oZnVuY3Rpb24gKGNvbm4pIHsNCiAgICAgIHJldHVybiBjb25uDQogICAgICAgIC5jcmVhdGVDaGFubmVsKCkNCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGNoKSB7DQogICAgICAgICAgdmFyIG9rID0gY2guYXNzZXJ0UXVldWUocSwgeyBkdXJhYmxlOiBmYWxzZSB9KTsNCiAgICAgICAgICByZXR1cm4gb2sudGhlbihmdW5jdGlvbiAoX3Fvaykgew0KICAgICAgICAgICAgY2guc2VuZFRvUXVldWUocSwgQnVmZmVyLmZyb20obXNnKSk7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiIFt4XSBTZW50ICclcyciLCBtc2cpOw0KICAgICAgICAgICAgcmV0dXJuIGNoLmNsb3NlKCk7DQogICAgICAgICAgfSk7DQogICAgICAgIH0pDQogICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICBjb25uLmNsb3NlKCk7DQogICAgICAgIH0pOw0KICAgIH0pDQogICAgLmNhdGNoKGNvbnNvbGUud2Fybik7DQp9DQoNCmZ1bmN0aW9uIGJpbjJzdHJpbmcoYXJyYXkpIHsNCiAgdmFyIHJlc3VsdCA9ICIiOw0KICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKSB7DQogICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYXJyYXlbaV0pOw0KICB9DQogIHJldHVybiByZXN1bHQ7DQp9DQoNCmV4cG9ydHMuaGFuZGxlciA9IGZ1bmN0aW9uIChjb250ZXh0LCBldmVudCkgew0KICB2YXIgX2V2ZW50ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShldmVudCkpOw0KICB2YXIgX2RhdGEgPSBiaW4yc3RyaW5nKF9ldmVudC5ib2R5LmRhdGEpOw0KICB2YXIgaHVtaWRpdHkgPSBwYXJzZUludChfZGF0YSk7DQoNCiAgaHVtaWRpdHkgPD0gMTAgPyBzZW5kX2FsZXJ0KCIiICsgaHVtaWRpdHkpIDogc2VuZF9sb2dzKCIiICsgaHVtaWRpdHkpOw0KDQogIGNvbnRleHQuY2FsbGJhY2soIlNlbnQgaHVtaWRpdHk6ICIgKyBodW1pZGl0eSk7DQp9Ow0K
    commands:
      - 'npm install amqplib'
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
